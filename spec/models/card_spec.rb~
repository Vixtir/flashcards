require "rails_helper"

RSpec.describe Card, type: "model" do
  describe Card do
    let!(:user) { build(:user, email: "test@test.com") }
    let!(:deck) { build(:deck, user: user)}

    it "is invalid when we have equal text" do
      card = build(:card,original_text: "olOlo", translated_text: "oLoLo")
      card.deck = deck
      card.user_id = 1
      expect(card).not_to be_valid
    end

    it "return downcased translate after save" do
      card = build(:card,original_text: "olOlO")
      card.deck_id = 1
      card.user_id = 1
      card.save
      expect(card.translated_text).to eq("ololo")
    end

    describe "check word" do
      it "has right answer" do
        card.deck_id = 1
        card.user_id = 1
        card.save
        t = card.review_date
        card.check_word("дОм")
        expect(card.review_date).to eq(t + 3.day)
      end

      it "has wrong answer" do
        card.deck_id = 1
        card.user_id = 1
        card.save
        t = card.review_date
        card.check_word("холл")
        expect(card.review_date).to eq(t)
      end
    end

    it "is return only need checked words" do
      user = create(:user, email: "test@gmail.com")
      deck = create(:deck, user: user)
      card1 = create(:card, user: user)
      card2 = create(:card, user: user)
      card2.check_word("дом")
      expect(Card.need_check).to match_array([card1])
    end
  end
end
